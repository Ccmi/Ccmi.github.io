<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="RxSwift,å­¦ä¹ ç¬”è®°," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œè®°å½•å­¦ä¹  RxSwift æ¡†æ¶ä¸€äº›æ¯”è¾ƒéš¾çš„ç‚¹ä»¥ä¾¿ä»¥åé—å¿˜æ¥æŸ¥æ‰¾èµ„æ–™ï¼Œå¹¶ä¸”å†™ä¸‹æ¥åŠ æ·±ç†è§£è®°å¿†ã€‚å¦å¤–ï¼ŒDemo å……åˆ†å±•ç¤ºäº†æˆ‘å¯¹ Material Design çš„çƒ­çˆ± â¤ã€‚">
<meta name="keywords" content="RxSwift,å­¦ä¹ ç¬”è®°">
<meta property="og:type" content="article">
<meta property="og:title" content="RxSwift ç™»å½•ç•Œé¢å®æˆ˜å­¦ä¹ ç¬”è®°">
<meta property="og:url" content="http://yoursite.com/2017/09/06/RxSwift + MVVM ç™»å½•ç•Œé¢å®æˆ˜å­¦ä¹ /index.html">
<meta property="og:site_name" content="Kipp&#39;s blog">
<meta property="og:description" content="è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œè®°å½•å­¦ä¹  RxSwift æ¡†æ¶ä¸€äº›æ¯”è¾ƒéš¾çš„ç‚¹ä»¥ä¾¿ä»¥åé—å¿˜æ¥æŸ¥æ‰¾èµ„æ–™ï¼Œå¹¶ä¸”å†™ä¸‹æ¥åŠ æ·±ç†è§£è®°å¿†ã€‚å¦å¤–ï¼ŒDemo å……åˆ†å±•ç¤ºäº†æˆ‘å¯¹ Material Design çš„çƒ­çˆ± â¤ã€‚">
<meta property="og:image" content="http://yoursite.com/img/Demo.gif">
<meta property="og:image" content="http://yoursite.com/img/LoginUI.PNG">
<meta property="og:updated_time" content="2017-09-06T09:37:11.948Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RxSwift ç™»å½•ç•Œé¢å®æˆ˜å­¦ä¹ ç¬”è®°">
<meta name="twitter:description" content="è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œè®°å½•å­¦ä¹  RxSwift æ¡†æ¶ä¸€äº›æ¯”è¾ƒéš¾çš„ç‚¹ä»¥ä¾¿ä»¥åé—å¿˜æ¥æŸ¥æ‰¾èµ„æ–™ï¼Œå¹¶ä¸”å†™ä¸‹æ¥åŠ æ·±ç†è§£è®°å¿†ã€‚å¦å¤–ï¼ŒDemo å……åˆ†å±•ç¤ºäº†æˆ‘å¯¹ Material Design çš„çƒ­çˆ± â¤ã€‚">
<meta name="twitter:image" content="http://yoursite.com/img/Demo.gif">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/09/06/RxSwift + MVVM ç™»å½•ç•Œé¢å®æˆ˜å­¦ä¹ /"/>





  <title>RxSwift ç™»å½•ç•Œé¢å®æˆ˜å­¦ä¹ ç¬”è®° | Kipp's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Kipp's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/06/RxSwift + MVVM ç™»å½•ç•Œé¢å®æˆ˜å­¦ä¹ /">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kipp">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kipp's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">RxSwift ç™»å½•ç•Œé¢å®æˆ˜å­¦ä¹ ç¬”è®°</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-06T10:31:36+08:00">
                2017-09-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p> è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œè®°å½•å­¦ä¹  RxSwift æ¡†æ¶ä¸€äº›æ¯”è¾ƒéš¾çš„ç‚¹ä»¥ä¾¿ä»¥åé—å¿˜æ¥æŸ¥æ‰¾èµ„æ–™ï¼Œå¹¶ä¸”å†™ä¸‹æ¥åŠ æ·±ç†è§£è®°å¿†ã€‚å¦å¤–ï¼ŒDemo å……åˆ†å±•ç¤ºäº†æˆ‘å¯¹ Material Design çš„çƒ­çˆ± â¤ã€‚</p>
 <a id="more"></a>
<h2 id="é¢„è§ˆ"><a href="#é¢„è§ˆ" class="headerlink" title="é¢„è§ˆ"></a>é¢„è§ˆ</h2><p><img src="/img/Demo.gif" alt="å®é™…æ•ˆæœ"></p>
<h3 id="ç™»å½•ç•Œé¢"><a href="#ç™»å½•ç•Œé¢" class="headerlink" title="ç™»å½•ç•Œé¢"></a>ç™»å½•ç•Œé¢</h3><ul>
<li>è¾“å…¥çš„è´¦å·å’Œå¯†ç å¿…é¡»å¤§äº 6 ä¸ªå­—ç¬¦ï¼›</li>
<li>å¦‚æœè´¦å·å’Œå¯†ç é•¿åº¦ä¸æ­£ç¡®ï¼Œç™»å½•æŒ‰é’®ä¸å¯ç‚¹å‡»ï¼›</li>
<li>è¾“å…¥æ—¶å°†å®æ—¶çŠ¶æ€ç»‘å®šåˆ°é”™è¯¯ä¿¡æ¯ Lable ä¸Šï¼›</li>
<li>ç”¨ MVVM è®¾è®¡æ¨¡å¼å°†é€»è¾‘ä»£ç å‰¥ç¦»å‡ºæ¥ï¼›</li>
</ul>
<h3 id="ç”¨åˆ°çš„æ¡†æ¶"><a href="#ç”¨åˆ°çš„æ¡†æ¶" class="headerlink" title="ç”¨åˆ°çš„æ¡†æ¶"></a>ç”¨åˆ°çš„æ¡†æ¶</h3><ul>
<li><a href="https://github.com/ReactiveX/RxSwift" target="_blank" rel="external">RxSwift</a> åšå“åº”å¼ç¼–ç¨‹å¯¹å„ä¸ªæ§ä»¶è¿›è¡Œç›‘å¬ç»‘å®šï¼›</li>
<li><a href="https://github.com/CosmicMind/Material" target="_blank" rel="external">Material</a> æ­å»º Material Design ç•Œé¢ï¼›</li>
<li><a href="https://github.com/0x73/SwiftIconFont" target="_blank" rel="external">SwiftIconFont</a> Demo ä¸­çš„æ‰€æœ‰å›¾æ ‡éƒ½æ˜¯ FontIconã€‚</li>
<li><a href="https://cocoapods.org" target="_blank" rel="external">CocoaPods</a> ç®¡ç†æ¡†æ¶</li>
</ul>
<h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><p>é¦–å…ˆå»ºç«‹ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå¯¼å…¥éœ€è¦çš„æ¡†æ¶ï¼Œå¦‚æœä½ ä¹Ÿæƒ³æ­å»ºä¸€ä¸ª Material Design æ ·å¼çš„ç•Œé¢ï¼Œå¯ä»¥å…ˆäº†è§£ä¸€ä¸‹ <a href="https://github.com/CosmicMind/Material" target="_blank" rel="external">Material</a> è¿™ä¸ªæ¡†æ¶ï¼Œå¦åˆ™å°±ç”¨ Storyboard ç®€å•æ‹–ä¸¤ä¸ªæ§ä»¶å°±è¡Œã€‚ç•Œé¢æ¯”è¾ƒç®€å•ï¼Œå°±ä¸å¤šè¯´äº†ã€‚</p>
<p>å¦å¤–ç”±äºæˆ‘ä»¬éœ€è¦ä¾æ‰˜ RxSwift åš MVVM è®¾è®¡æ¨¡å¼çš„å“åº”å¼ç¼–ç¨‹ï¼Œæ‰€ä»¥éœ€è¦åœ¨æ‰€æœ‰çš„ ViewController å’Œ ViewModel å¼•å…¥ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> RxSwift</div><div class="line"><span class="keyword">import</span> RxCocoa</div></pre></td></tr></table></figure>
<h2 id="ç™»å½•ç•Œé¢-1"><a href="#ç™»å½•ç•Œé¢-1" class="headerlink" title="ç™»å½•ç•Œé¢"></a>ç™»å½•ç•Œé¢</h2><h3 id="éœ€è¦ç”¨åˆ°çš„ç±»"><a href="#éœ€è¦ç”¨åˆ°çš„ç±»" class="headerlink" title="éœ€è¦ç”¨åˆ°çš„ç±»"></a>éœ€è¦ç”¨åˆ°çš„ç±»</h3><ul>
<li>LoginViewControllerï¼šæ­å»ºç•Œé¢ä¸ç”¨æˆ·äº¤äº’ï¼›</li>
<li>Protocolï¼šç”¨æ¥å»ºç«‹è¿”å›ç»“æœçš„ç±»å‹å’Œå¯¹ RxSwift çš„è‡ªå®šä¹‰æ‰©å±•ï¼›</li>
<li>UserViewModelï¼šå¤„ç†è¿”å›ç»“æœå¹¶å’Œ Controller ä¸­ç›¸åº”çš„æ§ä»¶è¿›è¡Œç»‘å®šï¼›</li>
<li>Serviceï¼šè¿™é‡Œæˆ‘ä»¬ç”¨æ¥å¤„ç†å¾—åˆ°è¾“å…¥æ¡†çš„å†…å®¹æ—¶åšç›¸åº”å¤„ç†å¹¶è¿”å›ä¸€ä¸ªå¯¹åº”çš„åºåˆ—ï¼ˆåºåˆ—åœ¨ä¸‹é¢æˆ‘ä¼šè¯´åˆ°ï¼Œå…¶å® RxSwift å°±æ˜¯å‘é€åºåˆ—ä¸ç›‘å¬åºåˆ—åšç›¸åº”å¤„ç†ï¼‰ï¼›</li>
</ul>
<h3 id="åˆ›å»ºä¸€äº›æ–‡ä»¶"><a href="#åˆ›å»ºä¸€äº›æ–‡ä»¶" class="headerlink" title="åˆ›å»ºä¸€äº›æ–‡ä»¶"></a>åˆ›å»ºä¸€äº›æ–‡ä»¶</h3><p>åˆ›å»ºä¸€ä¸ª Service.swift æ–‡ä»¶ï¼Œæ·»åŠ ä¸€ä¸ªç”¨äºå¤„ç†è¾“å…¥æ¡†å†…å®¹çš„ç±»ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ValidationService</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">let</span> instance = <span class="type">ValidationService</span>()</div><div class="line">    <span class="keyword">private</span> <span class="keyword">init</span>() &#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åˆ›å»ºä¸€ä¸ª Protocol.swift æ–‡ä»¶ï¼Œæ·»åŠ ä¸€ä¸ªè¿”å›ç»“æœçš„æšä¸¾ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Result</span> </span>&#123;</div><div class="line">    <span class="keyword">case</span> ok(message: <span class="type">String</span>)</div><div class="line">    <span class="keyword">case</span> empty(message: <span class="type">String</span>)</div><div class="line">    <span class="keyword">case</span> failed(message: <span class="type">String</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åˆ›å»º UserViewModel.swift æ–‡ä»¶ï¼Œæ·»åŠ ä¸€ä¸ªç±»ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserViewModel</span> </span>&#123;&#125;</div></pre></td></tr></table></figure>
<p>æœ€ååˆ›å»º LoginViewController.swift æ–‡ä»¶ï¼Œå†™å¥½ç›¸åº”çš„å¸ƒå±€ä»£ç ï¼Œè¿™é‡Œä»£ç è¾ƒå¤šå°±ä¸å±•ç¤ºäº†ï¼Œç•Œé¢å¤§æ¦‚åƒè¿™æ ·ï¼š<br><img src="/img/LoginUI.PNG" alt="ç™»å½•ç•Œé¢"></p>
<p>éœ€è¦ç”¨åˆ°çš„å®ä¾‹å˜é‡ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">fileprivate <span class="keyword">var</span> usernameTF: <span class="type">TextField</span>! <span class="comment">// è´¦å·</span></div><div class="line">fileprivate <span class="keyword">var</span> passwordTF: <span class="type">TextField</span>! <span class="comment">// å¯†ç </span></div><div class="line">fileprivate <span class="keyword">var</span> loginButton: <span class="type">Button</span>! <span class="comment">// ç™»å½•æŒ‰é’®</span></div><div class="line">fileprivate <span class="keyword">let</span> viewModel = <span class="type">UserViewModel</span>() <span class="comment">// ViewModelå¯¹è±¡</span></div><div class="line">fileprivate <span class="keyword">let</span> bag = <span class="type">DisposeBag</span>() <span class="comment">// RxSwift ä¸­ç”¨æ¥å›æ”¶ä¸éœ€è¦çš„åºåˆ—ï¼Œç±»ä¼¼ ARC</span></div></pre></td></tr></table></figure>
<h3 id="è´¦å·å¯†ç çš„å¤„ç†"><a href="#è´¦å·å¯†ç çš„å¤„ç†" class="headerlink" title="è´¦å·å¯†ç çš„å¤„ç†"></a>è´¦å·å¯†ç çš„å¤„ç†</h3><p>å®ç°å¯¹è¾“å…¥æ¡†è¿›è¡Œç›‘å¬ï¼Œæ²¡æœ‰è¾“å…¥å†…å®¹æ—¶æ²¡æœ‰æç¤ºæ–‡å­—ï¼Œè¾“å…¥å°‘äº 6 ä¸ªå­—ç¬¦æ—¶æç¤ºé•¿åº¦è‡³å°‘ 6 ä¸ªå­—ç¬¦ã€‚ï¼ˆè¿™é‡Œå¯ä»¥å°è¯•å°†å¯†ç è¾“å…¥æ¡†çš„å¯äº¤äº’ç»‘å®šåˆ°è´¦å·çš„å†…å®¹æ ¼å¼åˆæ³•åæ‰èƒ½è¾“å…¥ï¼Œç”šè‡³å°†è´¦å·è¾“å…¥æ—¶åšè”ç½‘æŸ¥è¯¢æ˜¯å¦æ•°æ®åº“å­˜åœ¨è¿™ä¸ªè´¦å·ï¼Œç¬¬ä¸€ç¯‡æ–‡ç« ä¸å¸Œæœ›å¤ªå¤æ‚ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å°è¯•ä¸€ä¸‹ã€‚ï¼‰</p>
<p>é¦–å…ˆæˆ‘ä»¬åœ¨ Service ä¸­å°†å¤„ç†æ–¹æ³•å†™å¥½ï¼Œä»¥ä¾¿åé¢ä½¿ç”¨ï¼Œæ¯”è¾ƒç®€å•ï¼Œæˆ‘éƒ½æ ‡æ³¨æœ‰æ³¨é‡Šï¼Œæœ€åè¿™ä¸ªç±»çœ‹èµ·æ¥åƒè¿™æ ·å­ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ValidationService</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">let</span> instance = <span class="type">ValidationService</span>()</div><div class="line">    <span class="keyword">private</span> <span class="keyword">init</span>() &#123;&#125;</div><div class="line"></div><div class="line">    <span class="keyword">let</span> minCharactersCount = <span class="number">6</span></div><div class="line"></div><div class="line">    <span class="comment">//æ£€æµ‹ç”¨æˆ·åæ˜¯å¦åˆæ³•</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">validateUsername</span><span class="params">(<span class="number">_</span> username: String)</span></span> -&gt; <span class="type">Observable</span>&lt;<span class="type">Result</span>&gt; &#123;</div><div class="line"></div><div class="line">        <span class="comment">//åˆ¤æ–­å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ä¸º 0 ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªåºåˆ—ï¼Œå†…å®¹ä¸º emptyï¼›</span></div><div class="line">        <span class="keyword">guard</span> username.characters.<span class="built_in">count</span> != <span class="number">0</span> <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> .just(.empty(message: <span class="string">""</span>))</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//åˆ¤æ–­å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦å¤§äºç­‰äº 6 ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªåºåˆ—ï¼Œå†…å®¹ä¸º failed å¹¶æºå¸¦é”™è¯¯ä¿¡æ¯ï¼›</span></div><div class="line">        <span class="keyword">guard</span> username.characters.<span class="built_in">count</span> &gt;= minCharactersCount <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> .just(.failed(message:<span class="string">"é•¿åº¦è‡³å°‘6ä¸ªå­—ç¬¦"</span>))</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//æˆ‘ä»¬å¦‚æœéœ€è¦åšè”ç½‘éªŒè¯å¯ä»¥åœ¨è¿™é‡Œåšç½‘ç»œè¯·æ±‚ï¼ŒéªŒè¯æœåŠ¡å™¨æ˜¯å¦å­˜åœ¨è¿™ä¸ªç”¨æˆ·åå¹¶è¿”å›ç›¸åº”çš„åºåˆ—ç»“æœå°±å¥½ï¼›</span></div><div class="line"></div><div class="line">        <span class="comment">//ç”¨æˆ·ååˆæ³•åˆ™è¿”å›ä¸€ä¸ªåºåˆ—ï¼Œ å†…å®¹ä¸º .ok æºå¸¦ä¿¡æ¯ä¸ºç©ºï¼›</span></div><div class="line">        <span class="keyword">return</span> .just(.ok(message: <span class="string">""</span>))</div><div class="line">        </div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//æ£€æµ‹å¯†ç æ˜¯å¦åˆæ³•ï¼ŒåŸºæœ¬å’Œç”¨æˆ·åéªŒè¯ç›¸åŒ</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">validatePassword</span><span class="params">(<span class="number">_</span> password: String)</span></span> -&gt; <span class="type">Result</span> &#123;</div><div class="line">        <span class="keyword">guard</span> password.characters.<span class="built_in">count</span> != <span class="number">0</span> <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> .empty(message: <span class="string">""</span>)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">guard</span> password.characters.<span class="built_in">count</span> &gt;= minCharactersCount <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> .failed(message: <span class="string">"é•¿åº¦è‡³å°‘6ä¸ªå­—ç¬¦"</span>)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> .ok(message: <span class="string">""</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//ç™»å½•äº‹ä»¶å¤„ç†</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">login</span><span class="params">(<span class="number">_</span> username: String, password: String)</span></span> -&gt; <span class="type">Observable</span>&lt;<span class="type">Result</span>&gt; &#123;</div><div class="line">        <span class="keyword">let</span> userDic = [username : password]</div><div class="line"></div><div class="line">        <span class="comment">//è¿™é‡Œåšç½‘ç»œè¯·æ±‚å¹¶è¿”å›Resultåºåˆ—,æ¨¡æ‹Ÿé»˜è®¤è¿”å›ç™»å½•æˆåŠŸ</span></div><div class="line">        <span class="keyword">return</span> .just(.ok(message: <span class="string">"ç™»å½•æˆåŠŸ"</span>))</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Protocol ä¸­æˆ‘ä»¬å°†å¯¹ Resultæšä¸¾ å’Œ RxCocoa è¿›è¡Œæ‰©å±•ï¼Œæœ€åçœ‹èµ·æ¥åƒè¿™ä¸ªæ ·å­ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Result</span> </span>&#123;<span class="comment">//æ¯ä¸ªçŠ¶æ€éƒ½ä¼šæºå¸¦ä¸€ä¸ªä¿¡æ¯</span></div><div class="line">    <span class="keyword">case</span> ok(message: <span class="type">String</span>) <span class="comment">// æˆåŠŸ</span></div><div class="line">    <span class="keyword">case</span> empty(message: <span class="type">String</span>) <span class="comment">// ç©ºç»“æœ</span></div><div class="line">    <span class="keyword">case</span> failed(message: <span class="type">String</span>) <span class="comment">// å¤±è´¥</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Result</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">//è¿™é‡Œç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªè¾“å…¥æ¡†çš„æµæ˜¯å¦åˆæ³•çš„ Bool å€¼</span></div><div class="line">    <span class="keyword">var</span> isValid: <span class="type">Bool</span> &#123;</div><div class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</div><div class="line">        <span class="keyword">case</span> .ok:</div><div class="line">            <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//é”™è¯¯ä¿¡æ¯çš„é¢œè‰²ï¼Œç”±äºè¿™é‡Œåªæœ‰é”™è¯¯æ‰ä¼šæœ‰é”™è¯¯ä¿¡æ¯ï¼Œæ‰€ä»¥åŸºæœ¬åªç”¨åˆ°çº¢è‰²</span></div><div class="line">    <span class="keyword">var</span> textColor: <span class="type">UIColor</span> &#123;</div><div class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</div><div class="line">        <span class="keyword">case</span> .ok:</div><div class="line">            <span class="keyword">return</span> <span class="type">UIColor</span>.clear</div><div class="line">        <span class="keyword">case</span> .empty:</div><div class="line">            <span class="keyword">return</span> <span class="type">UIColor</span>.black</div><div class="line">        <span class="keyword">case</span> .failed:</div><div class="line">            <span class="keyword">return</span> <span class="type">UIColor</span>.red</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//ç”¨äºè·å¾—å„ä¸ªè¿”å›ç»“æœæ‰€æºå¸¦çš„ä¿¡æ¯</span></div><div class="line">    <span class="keyword">var</span> description:<span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</div><div class="line">        <span class="keyword">case</span> .ok(<span class="keyword">let</span> message):</div><div class="line">            <span class="keyword">return</span> message</div><div class="line">        <span class="keyword">case</span> .failed(<span class="keyword">let</span> message):</div><div class="line">            <span class="keyword">return</span> message</div><div class="line">        <span class="keyword">case</span> .empty(<span class="keyword">let</span> message):</div><div class="line">            <span class="keyword">return</span> message</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//å¯¹ UILabel çš„æ‰©å±•ï¼Œè®© UILabel çš„æ–‡å­—å’Œé¢œè‰²ç»‘å®šåˆ° Result ç»“æœæšä¸¾ä¸Š</span></div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Reactive</span> <span class="title">where</span> <span class="title">Base</span>: <span class="title">UILabel</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> validationDetail: <span class="type">UIBindingObserver</span>&lt;<span class="type">Base</span>, <span class="type">Result</span>&gt; &#123;</div><div class="line">        <span class="keyword">return</span> <span class="type">UIBindingObserver</span>(<span class="type">UIElement</span>: base) &#123; label, result <span class="keyword">in</span></div><div class="line">            label.text = result.description</div><div class="line">            label.textColor = result.textColor</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//å¯¹ UITextField çš„æ‰©å±•ï¼Œè®© UITextFiled çš„å¯äº¤äº’çŠ¶æ€ç»‘å®šåˆ° Result ç»“æœæšä¸¾ä¸Š</span></div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Reactive</span> <span class="title">where</span> <span class="title">Base</span>: <span class="title">UITextField</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> inputEnable: <span class="type">UIBindingObserver</span>&lt;<span class="type">Base</span>, <span class="type">Result</span>&gt; &#123;</div><div class="line">        <span class="keyword">return</span> <span class="type">UIBindingObserver</span>(<span class="type">UIElement</span>: base, binding: &#123; (textFiled, result) <span class="keyword">in</span></div><div class="line">            textFiled.isEnabled = result.isValid</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ViewModel ä¸­æˆ‘ä»¬åšä¸€äº›æ•°æ®çš„å¤„ç†ï¼Œç”¨æ¥å’Œ ViewController å¯¹æ¥ï¼Œç»™å®ƒæƒ³è¦çš„ä¸œè¥¿ï¼Œçœ‹èµ·æ¥åƒè¿™æ ·å­ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserViewModel</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">//input:</span></div><div class="line">    <span class="keyword">let</span> username = <span class="type">Variable</span>&lt;<span class="type">String</span>&gt;(<span class="string">""</span>)<span class="comment">//ç”¨æˆ·åçš„è¾“å…¥æµ</span></div><div class="line">    <span class="keyword">let</span> password = <span class="type">Variable</span>&lt;<span class="type">String</span>&gt;(<span class="string">""</span>)<span class="comment">//å¯†ç çš„è¾“å…¥æµ</span></div><div class="line">    <span class="keyword">let</span> loginTaps = <span class="type">PublishSubject</span>&lt;<span class="type">Void</span>&gt;()<span class="comment">//ç™»å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶çš„è¾“å…¥æµï¼Œ PublishSubject å’Œ</span></div><div class="line"></div><div class="line">    <span class="comment">//output:</span></div><div class="line">    <span class="keyword">let</span> usernameUsable : <span class="type">Observable</span>&lt;<span class="type">Result</span>&gt; <span class="comment">//ç”¨æˆ·åçš„è¾“å‡ºæµï¼Œè¿”å›ä¸€ä¸ªåŒ…å« Result æšä¸¾ç»“æœçš„åºåˆ—</span></div><div class="line">    <span class="keyword">let</span> passwordUsable : <span class="type">Observable</span>&lt;<span class="type">Result</span>&gt; <span class="comment">//å¯†ç çš„è¾“å‡ºæµ</span></div><div class="line">    <span class="keyword">let</span> loginButtonEnable : <span class="type">Observable</span>&lt;<span class="type">Bool</span>&gt; <span class="comment">//ç™»å½•æŒ‰é’®æ˜¯å¦å¯ç‚¹å‡»è¾“å‡ºæµ</span></div><div class="line">    <span class="keyword">let</span> loginResult: <span class="type">Observable</span>&lt;<span class="type">Result</span>&gt; <span class="comment">//ç™»å½•ç»“æœè¾“å‡ºæµ</span></div><div class="line"></div><div class="line">    <span class="keyword">init</span>() &#123;</div><div class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªå¤„ç†ç»“æœçš„æœåŠ¡</span></div><div class="line">        <span class="keyword">let</span> service = <span class="type">ValidationService</span>.instance</div><div class="line"></div><div class="line">        <span class="comment">//ç”¨æˆ·åçš„è¾“å‡ºæµ,å› ä¸º username æ˜¯ Variable ç±»å‹ï¼Œæ‰€ä»¥è¿™é‡Œç”¨ä½œè¢«è§‚å¯Ÿçš„å¯¹è±¡ï¼ˆasObservableï¼‰ï¼›</span></div><div class="line">        <span class="comment">//å› ä¸ºéœ€è¦è¿”å›ä¸€ä¸ªæ–°çš„å¤„ç†ç»“æœåºåˆ—ï¼Œè¿™é‡Œç”¨ flatMap å¤„ç†å¹¶è¿”å›ç»“æœå‡ºå»ï¼›</span></div><div class="line">        <span class="comment">//shareReplay ä½œç”¨æ˜¯ä¸ç®¡å¤šå°‘ä¸ª Observer ç›‘å¬è¿™ä¸ªåºåˆ—ï¼Œæˆ‘ä»¬éƒ½åªæ‰§è¡Œä¸€æ¬¡å¤„ç†ç”¨æˆ·åçš„æ–¹æ³•ï¼ˆéœ€è¦æ…¢æ…¢æ¶ˆåŒ–ï¼Œæˆ‘éƒ½æ¶ˆåŒ–äº†å¾ˆä¹…ã€‚ï¼‰ï¼›</span></div><div class="line">        usernameUsable = username.asObservable()</div><div class="line">            .flatMapLatest &#123;</div><div class="line">                 service.validateUsername($<span class="number">0</span>)</div><div class="line">                    .observeOn(<span class="type">MainScheduler</span>.instance)</div><div class="line">                    .catchErrorJustReturn(.failed(message: <span class="string">"æ£€æµ‹å‡ºé”™"</span>))</div><div class="line">        &#125;</div><div class="line">        .shareReplay(<span class="number">1</span>)</div><div class="line"></div><div class="line">        <span class="comment">//å¯†ç çš„è¾“å‡ºæµï¼Œå¯†ç åªéœ€è¦æ£€æµ‹æ˜¯å¦åˆæ³•å°±å¯ä»¥äº†ï¼Œæ‰€ä»¥å’Œä¸Šé¢ç±»ä¼¼ä½œä¸ºå¯è§‚å¯Ÿå¯¹è±¡ï¼Œç”¨ map å°†ç”¨æˆ·åç»™ Service è¿›è¡Œæ£€æµ‹åˆæ³•æ€§ï¼Œç„¶åè¿”å›ä¸€ä¸ª Result ç±»å‹ç»“æœå°±å¥½</span></div><div class="line">        passwordUsable = password.asObservable()</div><div class="line">            .<span class="built_in">map</span>&#123;</div><div class="line">                service.validatePassword($<span class="number">0</span>)</div><div class="line">        &#125;</div><div class="line">        .shareReplay(<span class="number">1</span>)</div><div class="line"></div><div class="line">        <span class="comment">//ç™»å½•æŒ‰é’®çš„å¯äº¤äº’çŠ¶æ€ï¼Œè¿™é‡Œç”¨ combineLatest å°†ä¸¤ä¸ªåºåˆ—çš„ç»“æœè”åˆå¤„ç†ï¼Œå¦‚æœç”¨æˆ·åå’Œå¯†ç æ ¼å¼éƒ½åˆæ³•ä»¥åï¼Œæˆ‘ä»¬å°±è¿”å› true ;</span></div><div class="line">        <span class="comment">//Swift çš„è¯­æ³•ç³–æ¯”è¾ƒæœ‰æ„æ€ï¼Œå¦‚æœæ–¹æ³•é‡Œæ˜¯ç›´æ¥è¿”å›ä¸€ä¸ªç»“æœï¼Œåˆ™å¯ä»¥çœç•¥ return å…³é”®å­—ï¼›</span></div><div class="line">        <span class="comment">//å¦‚æœæ‡’å¾—åˆ›å»ºå½¢å‚å°±å¯ä»¥ç”¨ $0 æ¥è¡¨ç¤ºï¼Œä¸Šé¢ç”¨åˆ°å¾ˆå¤š $0 å°±æ˜¯è¿™ä¸ªæ„æ€;</span></div><div class="line">        loginButtonEnable = <span class="type">Observable</span>.combineLatest(usernameUsable.asObservable(),passwordUsable.asObservable()) &#123;</div><div class="line">            (username,password) <span class="keyword">in</span></div><div class="line">            username.isValid &amp;&amp; password.isValid</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        .distinctUntilChanged()<span class="comment">// åªæœ‰å½“æ•°æ®æœ‰å˜æ—¶æ‰ä¼šæ‰§è¡Œä¸Šé¢æ–¹æ³•ä½“é‡Œé¢çš„ä»£ç ã€‚</span></div><div class="line">        .shareReplay(<span class="number">1</span>)</div><div class="line"></div><div class="line">        <span class="comment">//å°† username å’Œ password è”åˆèµ·æ¥ç»„æˆä¸€ä¸ªæµ</span></div><div class="line">        <span class="keyword">let</span> usernameAndPassword = <span class="type">Observable</span>.combineLatest(username.asObservable(), password.asObservable()) &#123;</div><div class="line">            ($<span class="number">0</span>,$<span class="number">1</span>)<span class="comment">//æˆ‘å°±æ˜¯æ‡’ï¼Œä¸æƒ³åˆ›å»ºå˜é‡</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//è¿™é‡Œå¤„ç†ç™»å½•æŒ‰é’®ç‚¹å‡»åçš„ç»“æœï¼Œå°†æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ä½œä¸ºå¯ç›‘å¬;</span></div><div class="line">        <span class="comment">//å°†ä¸Šé¢åˆå¹¶çš„åºåˆ—ä¼ é€’è¿›æ¥ï¼Œç”¨ flatmap è¿”å›ä¸€ä¸ªæ–°çš„ç™»å½•ç»“æœåºåˆ—å‡ºå»;</span></div><div class="line">        loginResult = loginTaps.asObservable().withLatestFrom(usernameAndPassword)</div><div class="line">            .flatMapLatest&#123;</div><div class="line">                service.login($<span class="number">0.0</span>, password: $<span class="number">0.1</span>)<span class="comment">//æ‰§è¡Œç™»å½•æ–¹æ³•</span></div><div class="line">                    .observeOn(<span class="type">MainScheduler</span>.instance)<span class="comment">//ä¸ºäº†ç®€å•ï¼Œè¿™é‡Œæ˜¯ç›´æ¥åœ¨ä¸»çº¿ç¨‹åšçš„æ“ä½œ</span></div><div class="line">                    .catchErrorJustReturn(.failed(message: <span class="string">"ç™»å½•å‡ºé”™"</span>))<span class="comment">//å¦‚æœç™»å½•å¤±è´¥ï¼Œåˆ™è¿”å›ä¸€ä¸ªå¤±è´¥åºåˆ—å‡ºå»</span></div><div class="line">        &#125;</div><div class="line">        .shareReplay(<span class="number">1</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ€åæˆ‘ä»¬å°† Controller ä¸­çš„æ§ä»¶å’Œ VIewModel ä¸­çš„ç›¸å…³è¾“å…¥è¾“å‡ºç»‘å®šèµ·æ¥ï¼Œç•Œé¢å¸ƒå±€ä»£ç æˆ‘æ²¡æœ‰è´´ï¼Œåˆ°æ­¤å°±å®Œæˆäº†ï¼Œçœ‹èµ·æ¥åƒè¿™ä¸ªæ ·å­ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">KPLoginViewController</span>: <span class="title">KPBaseViewController</span> </span>&#123;</div><div class="line"></div><div class="line">    fileprivate <span class="keyword">var</span> usernameTF: <span class="type">TextField</span>!</div><div class="line">    fileprivate <span class="keyword">var</span> passwordTF: <span class="type">TextField</span>!</div><div class="line">    fileprivate <span class="keyword">var</span> loginButton: <span class="type">Button</span>!</div><div class="line">    fileprivate <span class="keyword">let</span> viewModel = <span class="type">UserViewModel</span>()</div><div class="line"></div><div class="line">    fileprivate <span class="keyword">var</span> headButton: <span class="type">IconButton</span>!</div><div class="line">    fileprivate <span class="keyword">var</span> undoButton: <span class="type">FlatButton</span>!</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">        isMotionEnabled = <span class="literal">true</span></div><div class="line">        addObserver()</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// MARK: - ç›‘å¬æ•°æ®ç»‘å®š</span></div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">KPLoginViewController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addObserver</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="comment">//å°†è¾“å…¥æ¡†çš„çš„æ–‡å­—ç»‘å®šåˆ° ViewModel ç”¨ä½œåç»­å¤„ç†</span></div><div class="line">        usernameTF.rx.text.orEmpty</div><div class="line">            .bind(to: viewModel.username)</div><div class="line">            .addDisposableTo(bag)</div><div class="line"></div><div class="line">        passwordTF.rx.text.orEmpty</div><div class="line">            .bind(to: viewModel.password)</div><div class="line">            .addDisposableTo(bag)</div><div class="line">            </div><div class="line">        <span class="comment">//å°†è¾“å…¥æ¡†çš„æç¤ºæ–‡å­—ç»‘å®šåˆ°å¯¹è¾“å…¥çš„æ–‡å­—å¤„ç†åçš„ç»“æœä¸Š</span></div><div class="line">        viewModel.usernameUsable</div><div class="line">            .bind(to: usernameTF.detailLabel.rx.validationDetail)</div><div class="line">            .addDisposableTo(bag)</div><div class="line"></div><div class="line">        viewModel.passwordUsable</div><div class="line">            .bind(to: passwordTF.detailLabel.rx.validationDetail)</div><div class="line">            .addDisposableTo(bag)</div><div class="line"></div><div class="line">        <span class="comment">//ç™»å½•æŒ‰é’®çš„çŠ¶æ€ç»‘å®šåˆ°å¯†ç è¾“å…¥æ¡†çš„å†…å®¹ä¸Šï¼Œå¦‚æœè¾“å…¥æ¡†è¿”å› .ok åˆ™å¯ä»¥ç‚¹å‡»ç™»å½•æŒ‰é’®ï¼Œå¦åˆ™ä¸å¯ã€‚</span></div><div class="line">        viewModel.loginButtonEnable</div><div class="line">            .subscribe(onNext: &#123; [<span class="keyword">unowned</span> <span class="keyword">self</span>] <span class="keyword">in</span></div><div class="line">                <span class="keyword">self</span>.loginButton.alpha = $<span class="number">0</span> ? <span class="number">1.0</span> : <span class="number">0.5</span></div><div class="line">                <span class="keyword">self</span>.loginButton.isEnabled = $<span class="number">0</span></div><div class="line"></div><div class="line">            &#125;)</div><div class="line">            .addDisposableTo(bag)</div><div class="line"></div><div class="line">        <span class="comment">//å¤„ç†ç™»é™†äº‹ä»¶</span></div><div class="line">        loginButton.rx.tap</div><div class="line">            .bind(to: viewModel.loginTaps)</div><div class="line">            .addDisposableTo(bag)</div><div class="line"></div><div class="line">        <span class="comment">//å°†å¾—åˆ°çš„ç™»å½•ç»“æœè¿›è¡Œå¤„ç†</span></div><div class="line">        viewModel.loginResult</div><div class="line">            .subscribe(onNext: &#123; [<span class="keyword">unowned</span> <span class="keyword">self</span>] <span class="keyword">in</span></div><div class="line">                <span class="keyword">switch</span> $<span class="number">0</span> &#123;</div><div class="line">                <span class="keyword">case</span> <span class="keyword">let</span> .ok(message):</div><div class="line">                    <span class="keyword">self</span>.snackbarController?.snackbar.text = message</div><div class="line">                    <span class="keyword">self</span>.snackbarController?.animateSnackbar()</div><div class="line">                <span class="keyword">case</span> .empty:</div><div class="line">                    <span class="keyword">break</span></div><div class="line">                <span class="keyword">case</span> <span class="keyword">let</span> .failed(message):</div><div class="line">                    <span class="keyword">self</span>.snackbarController?.snackbar.text = message</div><div class="line">                    <span class="keyword">self</span>.snackbarController?.animateSnackbar()</div><div class="line">                &#125;</div><div class="line">            &#125;)</div><div class="line">            .addDisposableTo(bag)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// MARK: - åˆ›å»ºä¸€ä¸ª Material æ¡†æ¶ä¸­çš„ snackbarcontroller ï¼Œç”¨æ¥æç¤ºç™»å½•ç»“æœã€‚</span></div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">KPLoginViewController</span> </span>&#123;</div><div class="line"></div><div class="line">    fileprivate <span class="function"><span class="keyword">func</span> <span class="title">prepareUndoButton</span><span class="params">()</span></span> &#123;</div><div class="line">        undoButton = <span class="type">FlatButton</span>(title: <span class="string">"çŸ¥é“äº†ï¼"</span>, titleColor: baseBarColor)</div><div class="line">        undoButton.pulseAnimation = .backing</div><div class="line">        undoButton.titleLabel?.font = snackbarController?.snackbar.textLabel.font</div><div class="line">        undoButton.addTarget(<span class="keyword">for</span>: .touchUpInside) &#123; (sender) <span class="keyword">in</span></div><div class="line">            <span class="keyword">self</span>.snackbarController?.animate(snackbar: .hidden)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    fileprivate <span class="function"><span class="keyword">func</span> <span class="title">prepareSnackbar</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> snackbar = snackbarController?.snackbar <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        snackbar.text = <span class="string">"å¦‚éœ€ä½¿ç”¨æœ¬APPï¼Œè¯·å‘ç®¡ç†å‘˜å’¨è¯¢æˆæƒå¹¶ç´¢å–ä¸“å±ç”¨æˆ·åå¯†ç ã€‚"</span></div><div class="line">        snackbar.rightViews = [undoButton]</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@objc</span></div><div class="line">    open <span class="function"><span class="keyword">func</span> <span class="title">animateSnackbar</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> sc = snackbarController <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="number">_</span> = sc.animate(snackbar: .visible, delay: <span class="number">1</span>)</div><div class="line">        <span class="number">_</span> = sc.animate(snackbar: .hidden, delay: <span class="number">4</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>RxSwift æ˜¯ä¸€ä¸ªå¯ä»¥æœ‰æ•ˆæé«˜ä»£ç è´¨é‡å’Œå¯¹å‡½æ•°å¼ç¼–ç¨‹ç†è§£çš„ä¸€ä¸ªæ¡†æ¶ï¼ˆè¿˜å¯ä»¥æé«˜å·¥èµ„ ğŸ˜ï¼‰ï¼Œæ­é…ä¸Š MVVM è®¾è®¡æ¨¡å¼å¯ä»¥è®©ä»£ç æ›´åŠ ç®€æ´é«˜æ•ˆä¸”æ›´å¥½çš„åšå•å…ƒæµ‹è¯•ï¼Œæ€»ä¹‹å°±æ˜¯é€šå¾€ä¸­é«˜çº§çš„æ·å¾„ã€‚</p>
<p>åé¢æˆ‘ä¼šå°†å­¦ä¹  Moya è¿™ä¸ªå¯¹ Alamofire ç®¡ç†çš„åº“å†™ä¸€ç¯‡å­¦ä¹ ç¬”è®°ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸éå¸¸å¥½çš„ä¸œè¥¿ã€‚</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/RxSwift/" rel="tag"># RxSwift</a>
          
            <a href="/tags/å­¦ä¹ ç¬”è®°/" rel="tag"># å­¦ä¹ ç¬”è®°</a>
          
        </div>
      

      
      
      

      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image"
              src="/uploads/avatar.jpg"
              alt="Kipp" />
          
            <p class="site-author-name" itemprop="name">Kipp</p>
            <p class="site-description motion-element" itemprop="description">Born to be proud.</p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives">
            
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#é¢„è§ˆ"><span class="nav-number">1.</span> <span class="nav-text">é¢„è§ˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ç™»å½•ç•Œé¢"><span class="nav-number">1.1.</span> <span class="nav-text">ç™»å½•ç•Œé¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç”¨åˆ°çš„æ¡†æ¶"><span class="nav-number">1.2.</span> <span class="nav-text">ç”¨åˆ°çš„æ¡†æ¶</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‡†å¤‡"><span class="nav-number">2.</span> <span class="nav-text">å‡†å¤‡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç™»å½•ç•Œé¢-1"><span class="nav-number">3.</span> <span class="nav-text">ç™»å½•ç•Œé¢</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#éœ€è¦ç”¨åˆ°çš„ç±»"><span class="nav-number">3.1.</span> <span class="nav-text">éœ€è¦ç”¨åˆ°çš„ç±»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åˆ›å»ºä¸€äº›æ–‡ä»¶"><span class="nav-number">3.2.</span> <span class="nav-text">åˆ›å»ºä¸€äº›æ–‡ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è´¦å·å¯†ç çš„å¤„ç†"><span class="nav-number">3.3.</span> <span class="nav-text">è´¦å·å¯†ç çš„å¤„ç†</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æœ€å"><span class="nav-number">4.</span> <span class="nav-text">æœ€å</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kipp</span>

  
</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
